THREE.OrbitControls=function(e,t){this.object=e;this.domElement=t!==undefined?t:document;this.enabled=true;this.center=new THREE.Vector3;this.userZoom=true;this.userZoomSpeed=1;this.userRotate=true;this.userRotateSpeed=1;this.userPan=true;this.userPanSpeed=2;this.autoRotate=false;this.autoRotateSpeed=2;this.minPolarAngle=0;this.maxPolarAngle=Math.PI;this.minDistance=0;this.maxDistance=Infinity;this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40,ROTATE:65,ZOOM:83,PAN:68};var a=this;var i=1e-6;var n=1800;var r=new THREE.Vector2;var o=new THREE.Vector2;var s=new THREE.Vector2;var R=new THREE.Vector2;var E=new THREE.Vector2;var d=new THREE.Vector2;var c=0;var I=0;var l=1;var f=new THREE.Vector3;var O={NONE:-1,ROTATE:0,ZOOM:1,PAN:2};var p=O.NONE;var u={type:"change"};this.rotateLeft=function(e){if(e===undefined){e=h()}I-=e};this.rotateRight=function(e){if(e===undefined){e=h()}I+=e};this.rotateUp=function(e){if(e===undefined){e=h()}c-=e};this.rotateDown=function(e){if(e===undefined){e=h()}c+=e};this.zoomIn=function(e){if(e===undefined){e=_()}l/=e};this.zoomOut=function(e){if(e===undefined){e=_()}l*=e};this.pan=function(e){e.transformDirection(this.object.matrix);e.multiplyScalar(a.userPanSpeed);this.object.position.add(e);this.center.add(e)};this.update=function(){var e=this.object.position;var t=e.clone().sub(this.center);var a=Math.atan2(t.x,t.z);var n=Math.atan2(Math.sqrt(t.x*t.x+t.z*t.z),t.y);if(this.autoRotate){this.rotateLeft(h())}a+=I;n+=c;n=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,n));n=Math.max(i,Math.min(Math.PI-i,n));var r=t.length()*l;r=Math.max(this.minDistance,Math.min(this.maxDistance,r));t.x=r*Math.sin(n)*Math.sin(a);t.y=r*Math.cos(n);t.z=r*Math.sin(n)*Math.cos(a);e.copy(this.center).add(t);this.object.lookAt(this.center);I=0;c=0;l=1;if(f.distanceTo(this.object.position)>0){this.dispatchEvent(u);f.copy(this.object.position)}};function h(){return 2*Math.PI/60/60*a.autoRotateSpeed}function _(){return Math.pow(.95,a.userZoomSpeed)}function m(e){if(a.enabled===false)return;if(a.userRotate===false)return;e.preventDefault();if(p===O.NONE){if(e.button===0)p=O.ROTATE;if(e.button===1)p=O.ZOOM;if(e.button===2)p=O.PAN}if(p===O.ROTATE){r.set(e.clientX,e.clientY)}else if(p===O.ZOOM){R.set(e.clientX,e.clientY)}else if(p===O.PAN){}document.addEventListener("mousemove",D,false);document.addEventListener("mouseup",M,false)}function D(e){if(a.enabled===false)return;e.preventDefault();if(p===O.ROTATE){o.set(e.clientX,e.clientY);s.subVectors(o,r);a.rotateLeft(2*Math.PI*s.x/n*a.userRotateSpeed);a.rotateUp(2*Math.PI*s.y/n*a.userRotateSpeed);r.copy(o)}else if(p===O.ZOOM){E.set(e.clientX,e.clientY);d.subVectors(E,R);if(d.y>0){a.zoomIn()}else{a.zoomOut()}R.copy(E)}else if(p===O.PAN){var t=e.movementX||e.mozMovementX||e.webkitMovementX||0;var i=e.movementY||e.mozMovementY||e.webkitMovementY||0;a.pan(new THREE.Vector3(-t,i,0))}}function M(e){if(a.enabled===false)return;if(a.userRotate===false)return;document.removeEventListener("mousemove",D,false);document.removeEventListener("mouseup",M,false);p=O.NONE}function T(e){if(a.enabled===false)return;if(a.userZoom===false)return;var t=0;if(e.wheelDelta){t=e.wheelDelta}else if(e.detail){t=-e.detail}if(t>0){a.zoomOut()}else{a.zoomIn()}}function v(e){if(a.enabled===false)return;if(a.userPan===false)return;switch(e.keyCode){case a.keys.ROTATE:p=O.ROTATE;break;case a.keys.ZOOM:p=O.ZOOM;break;case a.keys.PAN:p=O.PAN;break}}function P(e){switch(e.keyCode){case a.keys.ROTATE:case a.keys.ZOOM:case a.keys.PAN:p=O.NONE;break}}this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},false);this.domElement.addEventListener("mousedown",m,false);this.domElement.addEventListener("mousewheel",T,false);this.domElement.addEventListener("DOMMouseScroll",T,false);window.addEventListener("keydown",v,false);window.addEventListener("keyup",P,false)};THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype);var GUI={"Follow pipe":true,"View outside":function(){setView(VIEW_OUTSIDE)},"View center":function(){setView(VIEW_CENTER)},"View floor":function(){setView(VIEW_FLOOR)},"Pipe radius":.1,"Pipe anim speed":250,"Pipes max":1e3,"Joint radius":.15,"Room size":20,Reset:function(){resetPipes()}};window.onload=function(){var e=new dat.GUI;var t=e.addFolder("Camera");t.add(GUI,"Follow pipe");t.add(GUI,"View outside");t.add(GUI,"View center");t.add(GUI,"View floor");var a=e.addFolder("Geometry");a.add(GUI,"Pipe radius").onChange(function(e){PIPE_RADIUS=e;pipeGeo=new THREE.CylinderGeometry(PIPE_RADIUS,PIPE_RADIUS,1,PIPE_NUM_SIDES,1,false)});a.add(GUI,"Pipe anim speed");a.add(GUI,"Pipes max");a.add(GUI,"Joint radius");a.add(GUI,"Room size");e.add(GUI,"Reset")};"use strict";var PIPE_RADIUS=GUI["Pipe radius"];var PIPE_NUM_SIDES=10;var PIPE_ANIM_SPEED_PER_SECTION=GUI["Pipe anim speed"];var PIPES_MAX=GUI["Pipes max"];var JOINT_RADIUS=GUI["Joint radius"];var JOINT_NUM_SIDES=10;var ROOM_SIZE=GUI["Room size"];var HALF_ROOM=ROOM_SIZE/2;var POSSIBLE_DIRS=6;var DIR_UP=0,DIR_RIGHT=1,DIR_FORWARD=2,DIR_DOWN=3,DIR_LEFT=4,DIR_BACKWARD=5;var VIEW_OUTSIDE=0;var VIEW_CENTER=1;var VIEW_FLOOR=2;var container,scene,camera,renderer,controls;var origin;var floor;var numPipes=0;var pipes=[];var pipeGeo=new THREE.CylinderGeometry(PIPE_RADIUS,PIPE_RADIUS,1,PIPE_NUM_SIDES,1,false);var pipeText=new THREE.ImageUtils.loadTexture("textures/metal.png");pipeText.wrapS=pipeText.wrapT=THREE.RepeatWrapping;pipeText.repeat.set(.25,.25);var pipeMat=new THREE.MeshBasicMaterial({map:pipeText});var jointGeo=new THREE.SphereGeometry(JOINT_RADIUS,JOINT_NUM_SIDES,JOINT_NUM_SIDES);var jointMat=new THREE.MeshLambertMaterial({color:11184810});init();function init(){scene=new THREE.Scene;var e=window.innerWidth,t=window.innerHeight;var a=45,i=e/t,n=.1,r=200;camera=new THREE.PerspectiveCamera(a,i,n,r);scene.add(camera);setView(VIEW_OUTSIDE);renderer=new THREE.WebGLRenderer({antialias:true});renderer.setSize(e,t);container=document.createElement("container");document.body.appendChild(container);container.appendChild(renderer.domElement);controls=new THREE.OrbitControls(camera,renderer.domElement);controls.center=new THREE.Vector3(HALF_ROOM,HALF_ROOM,HALF_ROOM);renderer.shadowMapEnabled=true;var o=new THREE.PointLight(16777215);o.position.set(0,10,0);scene.add(o);var s=new THREE.HemisphereLight(16777215,16777215,.3);s.position.set(0,10,0);scene.add(s);var R=new THREE.BoxGeometry(ROOM_SIZE,ROOM_SIZE,ROOM_SIZE);var E=new THREE.MeshBasicMaterial({color:4473924,side:THREE.BackSide});var d=new THREE.Mesh(R,E);d.position.set(HALF_ROOM,HALF_ROOM,HALF_ROOM);scene.add(d);startPipe();render()}function resetPipes(){for(var e=0;e<pipes.length;e++){scene.remove(pipes[e])}pipes=[];setView(VIEW_OUTSIDE)}function setView(e){if(e==VIEW_CENTER)camera.position.set(HALF_ROOM,HALF_ROOM,HALF_ROOM);else if(e==VIEW_FLOOR)camera.position.set(HALF_ROOM,0,HALF_ROOM);else camera.position.set(HALF_ROOM,HALF_ROOM,HALF_ROOM+ROOM_SIZE)}function startPipe(){var e=new THREE.Vector3(Math.floor(Math.random()*ROOM_SIZE),Math.floor(Math.random()*ROOM_SIZE),Math.floor(Math.random()*ROOM_SIZE));var t=Math.floor(Math.random()*POSSIBLE_DIRS);addNext(e)}function addNext(e,t){if(numPipes++<PIPES_MAX){var a=true;while(a){var i;do{i=Math.floor(Math.random()*6)}while(i==t||i==DIR_UP&&t==DIR_DOWN||i==DIR_DOWN&&t==DIR_UP||i==DIR_LEFT&&t==DIR_RIGHT||i==DIR_RIGHT&&t==DIR_LEFT||i==DIR_FORWARD&&t==DIR_BACKWARD||i==DIR_BACKWARD&&t==DIR_FORWARD);var n=Math.max(Math.min(ROOM_SIZE-1,Math.floor(Math.random()*ROOM_SIZE)),.35);switch(i){case DIR_UP:if(e.y+n<ROOM_SIZE){a=false}break;case DIR_DOWN:if(e.y-n>0){a=false}break;case DIR_RIGHT:if(e.x+n<ROOM_SIZE){a=false}break;case DIR_LEFT:if(e.x-n>0){a=false}break;case DIR_FORWARD:if(e.z+n<ROOM_SIZE){a=false}break;case DIR_BACKWARD:if(e.z-n>0){a=false}break}}addPipe(e,n,i,addNext)}}function addPipe(e,t,a,i){var n=a==DIR_DOWN||a==DIR_LEFT||a==DIR_BACKWARD?-1:1;var r=new THREE.Mesh(pipeGeo,pipeMat);if(a==DIR_UP||a==DIR_DOWN)r.position.set(e.x,e.y+n*.5,e.z);else if(a==DIR_LEFT||a==DIR_RIGHT){r.rotateZ(Math.PI/2);r.position.set(e.x+n*.5,e.y,e.z)}else if(a==DIR_FORWARD||a==DIR_BACKWARD){r.rotateX(Math.PI/2);r.position.set(e.x,e.y,e.z+n*.5)}var o=false;var s=new TWEEN.Tween({scale:.01}).to({scale:t},PIPE_ANIM_SPEED_PER_SECTION*t).easing(TWEEN.Easing.Quadratic.InOut).onUpdate(function(){if(!o){scene.add(r);pipes.push(r);o=true}r.scale.y=this.scale;if(a==DIR_UP||a==DIR_DOWN)r.position.y=n*(this.scale/2)+e.y;else if(a==DIR_LEFT||a==DIR_RIGHT)r.position.x=n*(this.scale/2)+e.x;else if(a==DIR_FORWARD||a==DIR_BACKWARD)r.position.z=n*(this.scale/2)+e.z;if(GUI["Follow pipe"]){var t;if(a==DIR_UP||a==DIR_DOWN)t=new THREE.Vector3(e.x,e.y+n*this.scale,e.z);else if(a==DIR_LEFT||a==DIR_RIGHT)t=new THREE.Vector3(e.x+n*this.scale,e.y,e.z);else if(a==DIR_FORWARD||a==DIR_BACKWARD)t=new THREE.Vector3(e.x,e.y,e.z+n*this.scale);camera.lookAt(t)}}).onComplete(function(){var r=new THREE.Mesh(jointGeo,jointMat);var o;if(a==DIR_UP||a==DIR_DOWN)o=new THREE.Vector3(e.x,e.y+n*t,e.z);else if(a==DIR_LEFT||a==DIR_RIGHT)o=new THREE.Vector3(e.x+n*t,e.y,e.z);else if(a==DIR_FORWARD||a==DIR_BACKWARD)o=new THREE.Vector3(e.x,e.y,e.z+n*t);r.position.copy(o);scene.add(r);pipes.push(r);i(o,a)}).start()}function render(e){requestAnimationFrame(render);controls.update();TWEEN.update(e);renderer.render(scene,camera)}